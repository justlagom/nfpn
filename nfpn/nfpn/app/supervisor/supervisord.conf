[supervisord]
nodaemon=true
user=root
pidfile=/tmp/supervisord.pid
logfile=/tmp/supervisord.log
logfile_maxbytes=3MB
logfile_backups=2
loglevel=info

# ----------------- Cloudflared (Argo Tunnel) 进程配置 -----------------
[program:cloudflared]
; <YOUR_CLOUDFLARED_TUNNEL_TOKEN> 占位符会在 entrypoint.sh 中被替换
; 将 Cloudflare 流量转发到 Nginx 监听的 8001 端口
command=/usr/local/bin/cloudflared tunnel run --url http://127.0.0.1:8001 --token <YOUR_CLOUDFLARED_TUNNEL_TOKEN>
autostart=true
autorestart=true
priority=30 ; 保证在 Nginx 和 Xray 之后启动
redirect_stderr=true
stdout_logfile=/tmp/cloudflared.log
stdout_logfile_maxbytes=3MB
stdout_logfile_backups=2

# ----------------- Supercronic 进程配置 (用于定时运行保活脚本) -----------------
[program:supercronic]
; 假设您将 keepalive 任务定义在 /app/cron/my-crontab 文件中
command=/usr/local/bin/supercronic /app/cron/my-crontab
autostart=true
autorestart=true
priority=40
redirect_stderr=true
stdout_logfile=/tmp/supercronic.log
stdout_logfile_maxbytes=3MB
stdout_logfile_backups=2

# ----------------- Xray 进程配置 -----------------
[program:xy]
; 确保使用 /usr/local/bin/xy 路径，而不是直接 xy
command=/usr/local/bin/xy run -c /app/xy/config.json
autostart=true
autorestart=true
priority=20
redirect_stderr=true
stdout_logfile=/tmp/xy.log
stdout_logfile_maxbytes=3MB
stdout_logfile_backups=2

# ----------------- Nginx 进程配置 -----------------
[program:nginx]
; 确保使用 /usr/sbin/nginx 路径
command=/usr/sbin/nginx -c /app/nginx/nginx.conf -g "daemon off;"
autostart=true
autorestart=true
priority=10
redirect_stderr=true
stdout_logfile=/tmp/nginx.log
stdout_logfile_maxbytes=3MB
stdout_logfile_backups=2
